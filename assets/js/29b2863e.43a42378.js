"use strict";(self.webpackChunkharness_community=self.webpackChunkharness_community||[]).push([[8984],{3905:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},h=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),p=u(n),d=r,g=p["".concat(l,".").concat(d)]||p[d]||c[d]||i;return n?a.createElement(g,o(o({ref:t},h),{},{components:n})):a.createElement(g,o({ref:t},h))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2265:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const i={slug:"troubleshooting-harness-ci",title:"Troubleshooting Guide: Harness CI",authors:["dhrubajyoti"],tags:["continuous-integration","harness-ci","troubleshooting-guide","cme"]},o=void 0,s={permalink:"/blog/troubleshooting-harness-ci",editUrl:"https://github.com/harness-community/harness-community.github.io/tree/main/website/blog/2022-10-11-Troubleshooting-CI-Errors/troubleshooting-ci-guide.md",source:"@site/blog/2022-10-11-Troubleshooting-CI-Errors/troubleshooting-ci-guide.md",title:"Troubleshooting Guide: Harness CI",description:"Introduction",date:"2022-10-11T00:00:00.000Z",formattedDate:"October 11, 2022",tags:[{label:"continuous-integration",permalink:"/blog/tags/continuous-integration"},{label:"harness-ci",permalink:"/blog/tags/harness-ci"},{label:"troubleshooting-guide",permalink:"/blog/tags/troubleshooting-guide"},{label:"cme",permalink:"/blog/tags/cme"}],readingTime:6.09,hasTruncateMarker:!1,authors:[{name:"Dhrubajyoti Chakraborty",title:"Community Engineering Intern",url:"https://github.com/codewdhruv",imageURL:"https://media-exp1.licdn.com/dms/image/C5603AQFvCMGToV9LMQ/profile-displayphoto-shrink_800_800/0/1631719718974?e=1670457600&v=beta&t=vWbeVBiAvAYLTdxYcAnIqzuvveJ8IWleCDV0A5Fdbp0",key:"dhrubajyoti"}],frontMatter:{slug:"troubleshooting-harness-ci",title:"Troubleshooting Guide: Harness CI",authors:["dhrubajyoti"],tags:["continuous-integration","harness-ci","troubleshooting-guide","cme"]},prevItem:{title:"Provision Azure Infrastructure for Delegates",permalink:"/blog/azure-infra-for-delegates"},nextItem:{title:"Beginners Guide to Git Connectors",permalink:"/blog/git-connector"}},l={authorsImageUrls:[void 0]},u=[{value:"Introduction",id:"introduction",level:2},{value:"Verify Syntax",id:"verify-syntax",level:3},{value:"Verify Variables",id:"verify-variables",level:3},{value:"Delegate Setup Failure",id:"delegate-setup-failure",level:3},{value:"Delegate fails to establish a connection with the Harness Manager",id:"delegate-fails-to-establish-a-connection-with-the-harness-manager",level:3},{value:"No eligible delegate found for the assigned pipeline execution",id:"no-eligible-delegate-found-for-the-assigned-pipeline-execution",level:3},{value:"K8s Delegate Deletion Failure",id:"k8s-delegate-deletion-failure",level:3},{value:"Triggers Rejection Failures",id:"triggers-rejection-failures",level:3},{value:"Failure when executed Git Push in Harness",id:"failure-when-executed-git-push-in-harness",level:3},{value:"Triggers: zsh: no matches found",id:"triggers-zsh-no-matches-found",level:3},{value:"User does not have &quot;Deployment: execute&quot; permission",id:"user-does-not-have-deployment-execute-permission",level:3},{value:"NOT ABLE TO TROUBLESHOOT THE ENCOUNTERED ERROR",id:"not-able-to-troubleshoot-the-encountered-error",level:3}],h={toc:u};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"This is a guide to get started with the common use cases for the end users to implement pipeline executions successfully in Harness CI"),(0,r.kt)("p",null,"Harness provides various sources & tools to easily troubleshoot frequently encountered errors to fix pipeline failures. This guide lists some of the common issues faced while implementing and designing pipelines in Harness CI and the possible solutions."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"What\u2019ll we be covering here?")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Syntax Verification"),(0,r.kt)("li",{parentName:"ul"},"Variable Verification"),(0,r.kt)("li",{parentName:"ul"},"Troubleshooting Delegate Installation Errors"),(0,r.kt)("li",{parentName:"ul"},"Troubleshooting Triggers Errors"),(0,r.kt)("li",{parentName:"ul"},"Troubleshooting Git Experience Errors")),(0,r.kt)("h3",{id:"verify-syntax"},"Verify Syntax"),(0,r.kt)("p",null,"An early-stage error use case is generally incorrect syntax. In such cases, the pipeline returns an invalid YAML syntax message and does not start running in case any syntax error is detected."),(0,r.kt)("p",null,"Edit ",(0,r.kt)("inlineCode",{parentName:"p"},"pipeline.yaml")," in the pipeline studio"),(0,r.kt)("p",null,"The pipeline editor in the YAML view is recommended for editing experience (rather than the graphical stage view). Major features in the editor include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Creation of connectors, secrets & pipelines from scratch"),(0,r.kt)("li",{parentName:"ul"},"Realtime schema validation"),(0,r.kt)("li",{parentName:"ul"},"Intellisense & auto-completion"),(0,r.kt)("li",{parentName:"ul"},"Field descriptions & rich inline documentation"),(0,r.kt)("li",{parentName:"ul"},"Free Templates for YAML Samples ")),(0,r.kt)("p",null,"This feature helps the developer to validate the existing pipeline\u2019s correctness and helps in quick modification alongside copying of a pipeline as a code."),(0,r.kt)("h3",{id:"verify-variables"},"Verify Variables"),(0,r.kt)("p",null,"A very integral part of troubleshooting errors in Harness CI is to verify the variables present in the pipeline and their values. Major configuration in the pipeline depends on the variables and verifying them becomes the easiest way to reach the root cause and potential solution of the problem."),(0,r.kt)("p",null,"Visit the variables section on the Harness CI platform. Check if the expected variables and their values match and are implemented at the expected stage for the pipeline."),(0,r.kt)("h3",{id:"delegate-setup-failure"},"Delegate Setup Failure"),(0,r.kt)("p",null,"The majority of the encountered errors in Harness CI revolve around delegate setup processes. Make sure you have a complete understanding of how to set up a harness delegate from scratch & understand how the Harness manager and delegate complement each other."),(0,r.kt)("p",null,"Delegate setup also fails if the SSH key used for deployment to the targeted host is incorrect. This usually happens due to incorrect information about the SSH configuration in the Harness Secrets Management and also if the targeted host is not configured to support SSH connections."),(0,r.kt)("p",null,"For troubleshooting move to the ",(0,r.kt)("inlineCode",{parentName:"p"},"watcher.log")," file that provides information about the deleted version."),(0,r.kt)("h3",{id:"delegate-fails-to-establish-a-connection-with-the-harness-manager"},"Delegate fails to establish a connection with the Harness Manager"),(0,r.kt)("p",null,"In case of connection failures for the delegate with the Harness Manager, we can use ping on the delegate host to test the response time for app.harness.io and other URLs are consistent or not. We can use the traceroute to check the network route and verify if there is any case of redirection. To verify if the DNS resolution is working fine we can implement nslookup.\nWe can flush the client's DNS cache (Check for the OS). We can run tests to check for local network errors or NAT license limits. In the case of cloud service providers, we\u2019ll have to ensure that the security groups have outbound traffic allowed on HTTP 443."),(0,r.kt)("h3",{id:"no-eligible-delegate-found-for-the-assigned-pipeline-execution"},"No eligible delegate found for the assigned pipeline execution"),(0,r.kt)("p",null,"This error is encountered when the delegate fails to achieve the URL criteria for validation. All delegates in harness are identified by their Harness account ID with some additional factors. For example, in VMs the delegates are identified with the combination of their hostname and IP address thus in case the IP changes the Harness Manager fails to identify the delegate. In the case of K8s and ECS delegates, the IP changes when the pod is rescheduled."),(0,r.kt)("p",null,"The delegate sends the heartbeat, deployment data & Time series, and log data for continuous verification to the Harness Manager. The credentials used by the Delegate must have the roles and permissions required to perform the task. For example, if the account used for an AWS Cloud Provider does not have the roles required for ECS deployments then it will fail."),(0,r.kt)("p",null,"For more information visit ",(0,r.kt)("a",{parentName:"p",href:"https://docs.harness.io/article/migeq3achl-harness-delegate-faqs#how_does_harness_manager_identify_delegates"},"How does Harness Manager Identify Delegates?")),(0,r.kt)("h3",{id:"k8s-delegate-deletion-failure"},"K8s Delegate Deletion Failure"),(0,r.kt)("p",null,"To delete the Harness Delegate from the K8s cluster we\u2019ll have to delete the StateFulSet for the delegate. This ensures that the expected number of pods is running and available. Deletion of the delegate without deletion of the StateFulSet results in a recreation of the pod. "),(0,r.kt)("p",null,"For example, if the delegate name is ",(0,r.kt)("inlineCode",{parentName:"p"},"delegate-sample")," then we can delete StateFulSet with the command below"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl delete statefulset -n harness-delegate delegate-sample\n")),(0,r.kt)("h3",{id:"triggers-rejection-failures"},"Triggers Rejection Failures"),(0,r.kt)("p",null,"This usually happens when the user uses a webhook trigger to execute a pipeline or workflow and the name of the artifact in the cURL command is different from the name of the artifact."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Trigger Rejected. Reason: Artifacts Are Missing for Service Name(S)\n")),(0,r.kt)("p",null,"This is majorly a result of a bad name for an artifact build version when placed in the cURL command. For example a cURL with build number ",(0,r.kt)("strong",{parentName:"p"},"v1.0.4-RC8:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST -H \'content-type: application/json\'\n--url https://app.harness.io/gateway/api/webhooks/... . .\n-d \'{"application":"tavXGH . . z7POg","artifacts":[\n{"service":"app","buildNumber":"v1.0.4-RC8"}]}\'\n')),(0,r.kt)("p",null,"In case the Harness Service artifacts have a different nomenclature the cURL command will fail to execute. Thus ensuring the webhook cURL command has the correct artifact name becomes very important. "),(0,r.kt)("h3",{id:"failure-when-executed-git-push-in-harness"},"Failure when executed Git Push in Harness"),(0,r.kt)("p",null,"In case of two-way sync between the Git repository and the Harness Application, the push to Harness will result in failure unless the GIT YAML files and the required settings are configured before pushing the app to Harness."),(0,r.kt)("p",null,"For example, in case we have a predefined infrastructure definition and the required labels or parameters are not filled or filled in incorrectly the push to git is more likely to encounter a failure."),(0,r.kt)("p",null,"Using the Harness Manager to configure the app at first is the best way to encounter this error. This generally ensures that all the required settings are configured correctly and synced with the git repository. "),(0,r.kt)("h3",{id:"triggers-zsh-no-matches-found"},"Triggers: zsh: no matches found"),(0,r.kt)("p",null,"In some of the OS versions specifically in MACOS, the default shell is zsh. The zsh shell requires the cURL command to not use the \u201c?\u201d character or put quotes around the URL."),(0,r.kt)("p",null,"For example;"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST -H \'content-type: application/json\' --url https://app.harness.io/gateway/api/webhooks/xxx?accountId=xxx -d \'{"application":"fCLnFhwsTryU-HEdKDVZ1g","parameters":{"Environment":"K8sv2","test":"foo"}}\'\n')),(0,r.kt)("p",null,"This shall work"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST -H \'content-type: application/json\' --url "https://app.harness.io/gateway/api/webhooks/xxx?accountId=xxx -d \'{"application":"fCLnFhwsTryU-HEdKDVZ1g","parameters":{"Environment":"K8sv2","test":"foo"}}\'"\n')),(0,r.kt)("h3",{id:"user-does-not-have-deployment-execute-permission"},'User does not have "Deployment: execute" permission'),(0,r.kt)("p",null,"The error User does not have ",(0,r.kt)("inlineCode",{parentName:"p"},'"Deployment: execute"')," permission reflects back to the user\u2019s ",(0,r.kt)("strong",{parentName:"p"},"Application Permission > Settings")," does not involve ",(0,r.kt)("inlineCode",{parentName:"p"},"execute"),". This can be solved by resolving the application permission configuration. The user can easily modify the Harness Configure as Code YAML files for the harness application. "),(0,r.kt)("p",null,"To enable editing of the YAML file make sure the user\u2019s Harness User Groups must have the account permission ",(0,r.kt)("inlineCode",{parentName:"p"},"Manage Applications")," enabled. Also the Application Permissions ",(0,r.kt)("inlineCode",{parentName:"p"},"Update")," enabled for specific applications"),(0,r.kt)("h3",{id:"not-able-to-troubleshoot-the-encountered-error"},"NOT ABLE TO TROUBLESHOOT THE ENCOUNTERED ERROR"),(0,r.kt)("p",null,"In case the user is unable to troubleshoot the application error or pipeline execution failures the user can log/submit a ticket to Harness Support. To log a ticket follow the process:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Help")," button in the Harness Manager"),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Submit a Ticket")," or ",(0,r.kt)("strong",{parentName:"li"},"Send Screenshot")),(0,r.kt)("li",{parentName:"ol"},"Fill out the pop up form and click ",(0,r.kt)("strong",{parentName:"li"},"Submit Ticket")," or ",(0,r.kt)("strong",{parentName:"li"},"Send Feedback"))))}c.isMDXComponent=!0}}]);